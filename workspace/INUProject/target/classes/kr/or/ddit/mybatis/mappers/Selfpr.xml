<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.selfpr.dao.SelfprDAO">
	
	<!-- dropdown box 선택값 -->
	
	<select id="selectRegionList" resultType="hashmap">
		SELECT REGION_CODE "regionCode", REGION_NAME "regionName", REGION_REF "regionRef" 
		FROM CD_REGION
		<where>
			<choose>
				<when test="@org.apache.commons.lang3.StringUtils@isNotBlank(regionRef)">
					REGION_REF = #{regionRef}
				</when>
				<otherwise>
					REGION_REF IS NULL
				</otherwise>
			</choose>
		</where>
		ORDER BY 1
	</select>
	<select id="selectIndustry" resultType="hashmap">
		SELECT INDUSTRY_CODE "industryCode", INDUSTRY_NAME "industryName", INDUSTRY_REF "industryRef" 
		FROM CD_INDUSTRY
		<where>
			<choose>
				<when test="@org.apache.commons.lang3.StringUtils@isNotBlank(industryRef)">
					INDUSTRY_REF = #{industryRef}
				</when>
				<otherwise>
					INDUSTRY_REF IS NULL
				</otherwise>
			</choose>
		</where>
		ORDER BY 1
	</select>
	
	<!-- dropdown 박스 돌려서 나오는 쿼리 -->
	
	<sql id="searchFrag">
		<trim prefix="WHERE">
		    <if test="detailCondition neq null">
		    	<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(detailCondition.keyword.industryCode)">
		    		AND INDUSTRY_CODE = #{detailCondition.keyword.industryCode}
		    	</if>
		    	<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(detailCondition.keyword.regionCode)">
		    		AND(
		    		<trim prefixOverrides="OR">
				    	<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(detailCondition.keyword.regionCode)">
				    		OR REGION_CODE = #{detailCondition.keyword.regionCode}
				    	</if>
		    		</trim>
		    		)
		    	</if>
		    </if>
	    </trim>
	</sql>


	
	<select id="selectSelfprList" parameterType="PagingVO" resultType="kr.or.ddit.selfpr.vo.SelfprVO">
		WITH ORDEREDSELFPR AS (
		    SELECT A.MEM_ID, A.PR_NO, A.PR_NAME, A.PR_CONTENT, A.PR_WANTJOB, A.PR_ANNUAL,  A.PR_WANTMN, A.PR_WANTTYPE, A.PR_WANTLOCA,
               B.MEM_NAME
            FROM PR A
            INNER JOIN MEMBER B ON (A.MEM_ID = B.MEM_ID)           
		    ORDER BY PR_NO DESC
		)
		SELECT A.*
		FROM (
		    SELECT ROWNUM RNUM, ORDEREDSELFPR.*
		    FROM ORDEREDSELFPR
		) A
		WHERE RNUM BETWEEN #{startRow} AND #{endRow} 
	</select>	
	
	<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
		FROM PR
<!-- 		<include refid="searchFrag"/>  -->
	</select>
	
<!-- 	<select id="selectCateRecord" parameterType="PagingVO" resultType="int"> -->
<!-- 		SELECT COUNT(*) -->
<!-- 		FROM NEWS -->
<!-- 		WHERE NEWS_FIELD = #{newsField} -->
<!-- 	</select> -->
	
<!-- 	<select id="selectNews" parameterType="int" resultType="NewsVO"> -->
<!-- 		SELECT NEWS_NO, NEWS_FIELD, NEWS_NAME, NEWS_HIT, NEWS_DATE, NEWS_CONTENT -->
<!-- 		FROM NEWS -->
<!-- 		WHERE NEWS_NO = #{newsNo} -->
<!-- 	</select> -->
	
<!-- 	<insert id="insertNews" parameterType="NewsVO"> -->
<!-- 		<selectKey order="BEFORE" resultType="int" keyProperty="newsNo"> -->
<!-- 			SELECT NEWS_SEQ.NEXTVAL -->
<!-- 			FROM DUAL -->
<!-- 		</selectKey> -->
<!-- 		INSERT INTO NEWS ( -->
<!-- 		    NEWS_NO, -->
<!-- 		    NEWS_NAME, -->
<!-- 		    NEWS_DATE, -->
<!-- 		    NEWS_FIELD, -->
<!-- 		    NEWS_HIT, -->
<!-- 		    NEWS_CONTENT, -->
<!-- 		    MEM_ID -->
<!-- 		) VALUES ( -->
<!-- 			#{newsNo,jdbcType=NUMERIC} -->
<!-- 			, #{newsName,jdbcType=VARCHAR} -->
<!-- 			, SYSDATE -->
<!-- 			, #{newsField,jdbcType=VARCHAR} -->
<!-- 			, #{newsHit,jdbcType=NUMERIC} -->
<!-- 			, #{newsContent,jdbcType=VARCHAR} -->
<!-- 			, #{memId,jdbcType=VARCHAR} -->
<!-- 		) -->
<!-- 	</insert> -->
	
<!-- 	<update id="incrementHit" parameterType="int"> -->
<!-- 		UPDATE NEWS -->
<!-- 		SET -->
<!-- 		NEWS_HIT = NEWS_HIT + 1 -->
<!-- 		WHERE NEWS_NO = #{newsNo} -->
<!-- 	</update> -->
	
<!-- 	<update id="updateNews" parameterType="NewsVO"> -->
<!-- 		UPDATE NEWS -->
<!-- 		SET -->
<!-- 		    NEWS_NAME = #{newsName,jdbcType=VARCHAR} -->
<!-- 		    , NEWS_FIELD = #{newsField,jdbcType=VARCHAR} -->
<!-- 		    , NEWS_CONTENT = #{newsContent,jdbcType=VARCHAR} -->
<!-- 		WHERE NEWS_NO = #{newsNo} -->
<!-- 	</update> -->
	
<!-- 	<delete id="deleteNews" parameterType="int"> -->
<!-- 		DELETE  -->
<!-- 		FROM NEWS -->
<!-- 		WHERE NEWS_NO = #{newsNo} -->
<!-- 	</delete> -->
	
</mapper>